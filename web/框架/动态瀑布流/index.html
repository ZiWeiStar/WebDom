<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;

        }
        div.box{
            margin: 0 auto;
            position: relative;

        }
        div.box section{
            float: left;
            padding: 7px;
            width: 210px;
            box-sizing: border-box;
        }
        div.box section aside{
            width: 100%;
            background-color: white;
            border-radius: 3px;
            padding: 6px;
            box-sizing: border-box;
            box-shadow: 0 0 5px 2px rgb(0 0 0 / 30%);
        }
        div.box section aside img{
            width: 100%;
            vertical-align: middle;
           
        }
        .mask{
            position: fixed;
            background-color: rgb(0, 0, 0 , .3);
            width: 100%;
            height: 100%;
            left: 0; 
            top: 0;
        }
        .mask div{
            position: absolute;
            background-color: #D4DB55;
            text-align: center;
        }
        .mask div img {
            vertical-align: middle;
            width: 100%;
        }
        .mask div p {
            margin: 10px 20px 10px 30px;
        }
        .mask div button{
            padding: 7px 15px;
            
            margin: 0 70px;
        }

    </style>
</head>
<body>
  <div class="box" id="box">
    <!-- <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img2.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img3.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img4.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img5.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img6.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img2.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img3.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img4.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img5.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img6.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img1.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img2.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img3.png"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img4.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img5.jpg"></aside>
    </section>
    <section data-i="0">
        <aside><img src="../../images/img6.jpg"></aside>
    </section> -->
  </div>  
 
  <article id="mask"></article>
</body>
<script src="../../选项卡/agent.js"></script>
<!-- <script src="data.js"></script> -->
<script>
    var data=[
    {"src":'img1.png',info:'文字描述'},
    {"src":'img2.png',info:'文字描述'},
    {"src":'img3.png',info:'文字描述'},
    {"src":'img4.jpg',info:'文字描述'},
    {"src":'img5.jpg',info:'文字描述'},
    {"src":'img6.jpg',info:'文字描述'},
    {"src":'img1.png',info:'文字描述'},
    {"src":'8.jpg',info:'文字描述'},
    {"src":'9.jpg',info:'文字描述'},
    {"src":'1.jpg',info:'文字描述'},
    {"src":'6.jpg',info:'文字描述'},
    {"src":'7.jpg',info:'文字描述'},
    {"src":'2.jpg',info:'文字描述'},
    {"src":'3.jpg',info:'文字描述'},
    {"src":'8.jpg',info:'文字描述'},
    {"src":'9.jpg',info:'文字描述'},
    {"src":'1.jpg',info:'文字描述'},
    {"src":'6.jpg',info:'文字描述'},
    {"src":'5.jpg',info:'文字描述'},
    {"src":'5.jpg',info:'文字描述'},
    {"src":'4.jpg',info:'文字描述'},
]
    let oBox=document.getElementById('box');
    let oMask=document.getElementById('mask')
    
    let iWidth=210;
    let iCol=parseInt(document.documentElement.clientWidth / iWidth );
    let arr=[];

    oBox.style.width=iCol*iWidth+'px';
    
    data.forEach((el,i) => {
        // if(i<iCol){
            let oSection=document.createElement('section');
            oSection.setAttribute('data-i',i);
            oSection.innerHTML=`<aside><img src="../../images/${el.src}"></aside>`;
            oBox.appendChild(oSection);

    });
    // let aSection=oBox.querySelectorAll('section');//41个section的数组
    // let img=aSection[data.length-1].querySelector('img');//获取最后一个section的图片
    // img.onload=function(){
    // let aSection=oBox.querySelectorAll('section');
       
    //     aSection.forEach((el,i)=>{
    //         if(i<iCol){
    //             arr.push(el.offsetHeight);
    //         }else{
    //             el.style.position='absolute';
    //             let elMin=Math.min.apply(null,arr);//apply数组
    //             let j=arr.indexOf(elMin);
    //             el.style.top=elMin+'px';
    //             el.style.left=j*iWidth+'px'
    //             arr[j]=elMin+el.offsetHeight;
                

    //         }
    //     });
    // }//最后一张图片加载完成即所有图片加载完成。
    
    //  setTimeout(()=>{
        
    // },100)
    setTimeout(()=>{
        let aSection=oBox.querySelectorAll("section");
        aSection.forEach((el,i)=>{
            if(i<iCol){
                arr.push(el.offsetHeight);

            }else{
                el.style.position='absolute';
                let elMin=Math.min.apply(null,arr);
                let j=arr.indexOf(elMin);
                el.style.top=elMin+'px';
                el.style.left=j*iWidth+'px';
                arr[j]=elMin+el.offsetHeight;
            }
        });
    },100);
    agent1('box','click','section',function(){
        let i=this.getAttribute('data-i');
        // let imgSrc=data[i].src;
        // let oMask=document.createElement('article');
        oMask.className='mask';
        let oDiv=document.createElement('div');

        // oDiv.innerHTML=`<img src=../../images${imgSrc}>
        //     <p>${data[i].info}</p>
        //     <button class='prev'前一张></button>
        //     <button class='next'>后一张</button>`
            oMask.appendChild(oDiv)
            align(oDiv,i)
            // oDiv.querySelector('img').onload=function(){

            // oDiv.style.height=Math.min(oDiv.offsetHeight,document.documentElement.clientHeight)+'px';
            // document.title=oDiv.offsetHeight;
            // oDiv.style.top=(document.documentElement.clientHeight-oDiv.offsetHeight)/2+'px';
            // oDiv.style.left=(document.documentElement.clientWidth-oDiv.offsetWidth)/2+'px';
            // this.onload='null';
        
           
           
        });
        function align(oDiv,i){
        let imgSrc=data[i].src;
        oDiv.innerHTML=`<img src="../../images/${imgSrc}">
                        <P>${data[i].info}</p>
                        <button class="prev" data-i="${i}">前一张</button>
                        <button class="next"  data-i="${i}">后一张</button>
                        `
        let img1=oDiv.querySelector('img');
        img1.onload=function(){
            this.style.height=Math.min(this.offsetHeight,document.documentElement.clientHeight-100)+'px';
            oDiv.style.top=(document.documentElement.clientHeight-oDiv.offsetHeight)/2+'px';
            oDiv.style.left=(document.documentElement.clientWidth-oDiv.offsetWidth)/2+'px';
            this.onload=null;
        }

    }
    oMask.onclick=function(e){
        let that=e.target;
        if(that.className==='prev'){
            let i=that.getAttribute('data-i')-1;
            let oDiv=that.parentNode;
            if(i>=0)align(oDiv,i)
            
        }
        else if(that.className==='next'){
            let i=that.getAttribute('data-i')-0+1;
            let oDiv=that.parentNode;
            if(i<data.length)align(oDiv,i)

        }
        else{
            if(this.innerHTML!==''){
                this.removeChild(this.querySelector('div'));
            }
            oMask.className='';
        }
    }



        
</script>
</html>